<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Generalized Models | Module 4</title>
  <meta name="description" content="<p>This is a trial run of putting out a book for a stats class.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Generalized Models | Module 4" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a trial run of putting out a book for a stats class.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Generalized Models | Module 4" />
  
  <meta name="twitter:description" content="<p>This is a trial run of putting out a book for a stats class.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Leo_Ohyama" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="module-4.html"/>
<link rel="next" href="overdispersion.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> url: your book url like <span>https://bookdown.org/yihui/bookdown</span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.1</b> Usage</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#render-book"><i class="fa fa-check"></i><b>1.2</b> Render book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preview-book"><i class="fa fa-check"></i><b>1.3</b> Preview book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="module-2.html"><a href="module-2.html"><i class="fa fa-check"></i><b>2</b> Module 2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="module-2.html"><a href="module-2.html#a.-introduction-to-data-visualization"><i class="fa fa-check"></i><b>2.1</b> 2A. Introduction to Data Visualization</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="module-2.html"><a href="module-2.html#continuous-variables"><i class="fa fa-check"></i><b>2.1.1</b> Continuous Variables</a></li>
<li class="chapter" data-level="2.1.2" data-path="module-2.html"><a href="module-2.html#fancy-scatterplots"><i class="fa fa-check"></i><b>2.1.2</b> Fancy Scatterplots</a></li>
<li class="chapter" data-level="2.1.3" data-path="module-2.html"><a href="module-2.html#continuous-variables-1"><i class="fa fa-check"></i><b>2.1.3</b> Continuous Variables</a></li>
<li class="chapter" data-level="2.1.4" data-path="module-2.html"><a href="module-2.html#different-types-of-plots-for-categorical-data-with-ggplot2"><i class="fa fa-check"></i><b>2.1.4</b> Different types of plots for categorical data with ggplot2</a></li>
<li class="chapter" data-level="2.1.5" data-path="module-2.html"><a href="module-2.html#breakout-group-challenge"><i class="fa fa-check"></i><b>2.1.5</b> Breakout group challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="module-2.html"><a href="module-2.html#b.-introduction-to-regression"><i class="fa fa-check"></i><b>2.2</b> 2B. Introduction to Regression</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="module-2.html"><a href="module-2.html#an-example-of-linear-regression-in-r"><i class="fa fa-check"></i><b>2.2.1</b> An Example of Linear Regression in R</a></li>
<li class="chapter" data-level="2.2.2" data-path="module-2.html"><a href="module-2.html#regression-challenge"><i class="fa fa-check"></i><b>2.2.2</b> Regression Challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="module-2.html"><a href="module-2.html#c.-introduction-to-anova"><i class="fa fa-check"></i><b>2.3</b> 2C. Introduction to ANOVA</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="module-2.html"><a href="module-2.html#example-of-a-one-way-anova-in-r"><i class="fa fa-check"></i><b>2.3.1</b> Example of a one-way ANOVA in R</a></li>
<li class="chapter" data-level="2.3.2" data-path="module-2.html"><a href="module-2.html#anova-challenge"><i class="fa fa-check"></i><b>2.3.2</b> ANOVA Challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="module-2.html"><a href="module-2.html#extra-data-visualization"><i class="fa fa-check"></i><b>2.4</b> Extra Data Visualization</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="module-2.html"><a href="module-2.html#adding-averages-to-plots-part-2"><i class="fa fa-check"></i><b>2.4.1</b> Adding averages to plots part 2</a></li>
<li class="chapter" data-level="2.4.2" data-path="module-2.html"><a href="module-2.html#r-challenge"><i class="fa fa-check"></i><b>2.4.2</b> R Challenge</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="module-3.html"><a href="module-3.html"><i class="fa fa-check"></i><b>3</b> Module 3</a>
<ul>
<li class="chapter" data-level="3.1" data-path="module-3.html"><a href="module-3.html#a.-data-management"><i class="fa fa-check"></i><b>3.1</b> 3A. Data Management</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="module-3.html"><a href="module-3.html#making-and-modifying-variables"><i class="fa fa-check"></i><b>3.1.1</b> Making and modifying variables</a></li>
<li class="chapter" data-level="3.1.2" data-path="module-3.html"><a href="module-3.html#variables-with-the-tidyverse"><i class="fa fa-check"></i><b>3.1.2</b> Variables with the tidyverse</a></li>
<li class="chapter" data-level="3.1.3" data-path="module-3.html"><a href="module-3.html#reshape-data-for-better-usability"><i class="fa fa-check"></i><b>3.1.3</b> Reshape data for better usability</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="module-3.html"><a href="module-3.html#b.-data-exploration"><i class="fa fa-check"></i><b>3.2</b> 3B. Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="module-3.html"><a href="module-3.html#distributions-summary-statistics"><i class="fa fa-check"></i><b>3.2.1</b> Distributions &amp; summary statistics</a></li>
<li class="chapter" data-level="3.2.2" data-path="module-3.html"><a href="module-3.html#examining-for-outliers"><i class="fa fa-check"></i><b>3.2.2</b> Examining for outliers</a></li>
<li class="chapter" data-level="3.2.3" data-path="module-3.html"><a href="module-3.html#explore-relationships"><i class="fa fa-check"></i><b>3.2.3</b> Explore relationships</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="module-3.html"><a href="module-3.html#c.-model-selection"><i class="fa fa-check"></i><b>3.3</b> 3C. Model Selection</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="module-3.html"><a href="module-3.html#quick-introduction"><i class="fa fa-check"></i><b>3.3.1</b> Quick introduction</a></li>
<li class="chapter" data-level="3.3.2" data-path="module-3.html"><a href="module-3.html#basic-calculations"><i class="fa fa-check"></i><b>3.3.2</b> Basic calculations</a></li>
<li class="chapter" data-level="3.3.3" data-path="module-3.html"><a href="module-3.html#aicc"><i class="fa fa-check"></i><b>3.3.3</b> AICc</a></li>
<li class="chapter" data-level="3.3.4" data-path="module-3.html"><a href="module-3.html#case-study-with-aic"><i class="fa fa-check"></i><b>3.3.4</b> Case study with AIC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="module-4.html"><a href="module-4.html"><i class="fa fa-check"></i><b>4</b> Module 4</a>
<ul>
<li class="chapter" data-level="4.1" data-path="module-4.html"><a href="module-4.html#a.-generalized-models"><i class="fa fa-check"></i><b>4.1</b> 4A. Generalized Models</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="module-4.html"><a href="module-4.html#example-conducting-a-one-way-anova-with-non-normal-data"><i class="fa fa-check"></i><b>4.1.1</b> Example: Conducting a one-way ANOVA with non-normal data</a></li>
<li class="chapter" data-level="4.1.2" data-path="module-4.html"><a href="module-4.html#log-linear-model"><i class="fa fa-check"></i><b>4.1.2</b> Log-linear model</a></li>
<li class="chapter" data-level="4.1.3" data-path="module-4.html"><a href="module-4.html#generalized-linear-models"><i class="fa fa-check"></i><b>4.1.3</b> Generalized linear models</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="module-4.html"><a href="module-4.html#b.-overdispersion"><i class="fa fa-check"></i><b>4.2</b> 4B. Overdispersion</a></li>
<li class="chapter" data-level="4.3" data-path="module-4.html"><a href="module-4.html#c.-binomial-glm"><i class="fa fa-check"></i><b>4.3</b> 4C. Binomial GLM</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="generalized-models.html"><a href="generalized-models.html"><i class="fa fa-check"></i><b>5</b> Generalized Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="generalized-models.html"><a href="generalized-models.html#example-conducting-a-one-way-anova-with-non-normal-data-1"><i class="fa fa-check"></i><b>5.1</b> Example: Conducting a one-way ANOVA with non-normal data</a></li>
<li class="chapter" data-level="5.2" data-path="generalized-models.html"><a href="generalized-models.html#log-linear-model-1"><i class="fa fa-check"></i><b>5.2</b> Log-linear model</a></li>
<li class="chapter" data-level="5.3" data-path="generalized-models.html"><a href="generalized-models.html#generalized-linear-models-1"><i class="fa fa-check"></i><b>5.3</b> Generalized linear models</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overdispersion.html"><a href="overdispersion.html"><i class="fa fa-check"></i><b>6</b> Overdispersion</a></li>
<li class="chapter" data-level="7" data-path="binomial-glm.html"><a href="binomial-glm.html"><i class="fa fa-check"></i><b>7</b> Binomial GLM</a></li>
<li class="chapter" data-level="8" data-path="module-5.html"><a href="module-5.html"><i class="fa fa-check"></i><b>8</b> Module 5</a>
<ul>
<li class="chapter" data-level="8.1" data-path="module-5.html"><a href="module-5.html#a.-ancovas-in-r"><i class="fa fa-check"></i><b>8.1</b> 5A. ANCOVAs in R</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="module-5.html"><a href="module-5.html#ancova-multiple-intercept-model"><i class="fa fa-check"></i><b>8.1.1</b> ANCOVA: multiple intercept model</a></li>
<li class="chapter" data-level="8.1.2" data-path="module-5.html"><a href="module-5.html#ancova-multiple-intercept-and-slope-model"><i class="fa fa-check"></i><b>8.1.2</b> ANCOVA: multiple intercept AND slope model</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="module-5.html"><a href="module-5.html#b.-block-designs"><i class="fa fa-check"></i><b>8.2</b> 5B. Block Designs</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="module-5.html"><a href="module-5.html#data-and-plotting"><i class="fa fa-check"></i><b>8.2.1</b> Data and Plotting</a></li>
<li class="chapter" data-level="8.2.2" data-path="module-5.html"><a href="module-5.html#models"><i class="fa fa-check"></i><b>8.2.2</b> Models</a></li>
<li class="chapter" data-level="8.2.3" data-path="module-5.html"><a href="module-5.html#blocks-as-random-effects"><i class="fa fa-check"></i><b>8.2.3</b> Blocks as Random Effects</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Module 4</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-models" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Generalized Models<a href="generalized-models.html#generalized-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="generalized-models.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb119-2"><a href="generalized-models.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb119-3"><a href="generalized-models.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb119-4"><a href="generalized-models.html#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agridat)</span></code></pre></div>
<div id="example-conducting-a-one-way-anova-with-non-normal-data-1" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Example: Conducting a one-way ANOVA with non-normal data<a href="generalized-models.html#example-conducting-a-one-way-anova-with-non-normal-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s load up the InsectSprays data</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="generalized-models.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;InsectSprays&quot;</span>)<span class="co"># available from base R  </span></span></code></pre></div>
<p>Now we need to filter the data to just 4 treatments:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="generalized-models.html#cb121-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> InsectSprays <span class="sc">%&gt;%</span> <span class="fu">filter</span>(spray<span class="sc">==</span><span class="st">&#39;A&#39;</span><span class="sc">|</span>spray<span class="sc">==</span><span class="st">&#39;B&#39;</span><span class="sc">|</span>spray<span class="sc">==</span><span class="st">&#39;C&#39;</span><span class="sc">|</span>spray<span class="sc">==</span><span class="st">&#39;F&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="generalized-models.html#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span></code></pre></div>
<p>Let’s plot out data:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="generalized-models.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x=</span>spray,<span class="at">y=</span>count)) <span class="sc">+</span> </span>
<span id="cb122-2"><a href="generalized-models.html#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb122-3"><a href="generalized-models.html#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span><span class="dv">0</span>,<span class="at">width=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb122-4"><a href="generalized-models.html#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb122-5"><a href="generalized-models.html#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">15</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-54-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="generalized-models.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>count)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-55-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now let’s construct a linear model to examine the effect of the different sprays on insect counts:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="generalized-models.html#cb124-1" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(count<span class="sc">~</span>spray, <span class="at">data=</span>d)</span>
<span id="cb124-2"><a href="generalized-models.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(lm1, <span class="at">type=</span><span class="dv">2</span>)  <span class="do">## car::Anova will print out an ANOVA table</span></span></code></pre></div>
<pre><code>## Anova Table (Type II tests)
## 
## Response: count
##            Sum Sq Df F value    Pr(&gt;F)    
## spray     1648.73  3  26.478 6.091e-10 ***
## Residuals  913.25 44                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Let’s check the residuals of the model:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="generalized-models.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(lm1)) <span class="co">#&#39; residuals should be normally distributed, even for glm</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-57-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="generalized-models.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(lm1)<span class="sc">~</span><span class="fu">fitted</span>(lm1))   <span class="do">## residuals should be evenly dispersed around 0 across the range of x&#39;s</span></span>
<span id="cb127-2"><a href="generalized-models.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)     <span class="co"># funnel shapes or curvature is bad</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-57-2.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="generalized-models.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">resid</span>(lm1))  <span class="do">## residuals should line up pretty closely to the blue line</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-58-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre><code>## [1] 45 46</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="generalized-models.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm1) <span class="sc">~</span> d<span class="sc">$</span>spray)  <span class="do">## variances should be homogeneous for each group</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-59-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Let’s use emmeans:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="generalized-models.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(lm1, <span class="sc">~</span>spray)</span></code></pre></div>
<pre><code>##  spray emmean   SE df lower.CL upper.CL
##  A      14.50 1.32 44   11.849    17.15
##  B      15.33 1.32 44   12.683    17.98
##  C       2.08 1.32 44   -0.567     4.73
##  F      16.67 1.32 44   14.016    19.32
## 
## Confidence level used: 0.95</code></pre>
<p>Note all the SE are the same and CL is off.</p>
</div>
<div id="log-linear-model-1" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Log-linear model<a href="generalized-models.html#log-linear-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now let’s use a log-linear model to examine the effect of the different sprays on insect counts.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="generalized-models.html#cb133-1" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>)<span class="sc">~</span>spray, <span class="at">data=</span>d)</span>
<span id="cb133-2"><a href="generalized-models.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(lm2, <span class="at">type=</span><span class="dv">2</span>)  <span class="do">## car::Anova will print out an ANOVA table testing</span></span></code></pre></div>
<pre><code>## Anova Table (Type II tests)
## 
## Response: log(count + 1)
##            Sum Sq Df F value    Pr(&gt;F)    
## spray     29.3651  3  56.682 3.701e-15 ***
## Residuals  7.5984 44                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Let’s check residuals:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="generalized-models.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(lm2)) <span class="do">## residuals should be normally distributed, even for glm</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-62-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="generalized-models.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(lm2)<span class="sc">~</span><span class="fu">fitted</span>(lm2)) <span class="sc">+</span>  <span class="do">## residuals should be evenly dispersed around 0 across the range of x&#39;s</span></span>
<span id="cb136-2"><a href="generalized-models.html#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)                               <span class="co"># funnel shapes or curvature is bad</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-62-2.png" width="960" style="display: block; margin: auto;" /></p>
<pre><code>## integer(0)</code></pre>
<p>qqPlot and boxplot next:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="generalized-models.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">resid</span>(lm2))  <span class="do">## residuals should line up pretty closely to the blue line</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-63-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre><code>## [1] 27 25</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="generalized-models.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm2) <span class="sc">~</span> d<span class="sc">$</span>spray)  <span class="do">## variances should be homogeneous for each group</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-63-2.png" width="960" style="display: block; margin: auto;" /></p>
<p>Let’s use emmeans again:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="generalized-models.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(lm2, <span class="sc">~</span>spray) <span class="do">## note that now all means are back-transformed</span></span></code></pre></div>
<pre><code>##  spray emmean   SE df lower.CL upper.CL
##  A      2.697 0.12 44    2.455     2.94
##  B      2.757 0.12 44    2.515     3.00
##  C      0.953 0.12 44    0.711     1.19
##  F      2.816 0.12 44    2.574     3.06
## 
## Results are given on the log(mu + 1) (not the response) scale. 
## Confidence level used: 0.95</code></pre>
<p>To calculate back-transformed emmeans we can add additional arguments:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="generalized-models.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(lm2, <span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>) <span class="do">## note that now all means are back-transformed</span></span></code></pre></div>
<pre><code>##  spray response    SE df lower.CL upper.CL
##  A        13.83 1.779 44    10.65     17.9
##  B        14.75 1.889 44    11.36     19.1
##  C         1.59 0.311 44     1.04      2.3
##  F        15.70 2.004 44    12.12     20.3
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log(mu + 1) scale</code></pre>
</div>
<div id="generalized-linear-models-1" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Generalized linear models<a href="generalized-models.html#generalized-linear-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now let’s use GLMs to examine the effect of the different sprays:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="generalized-models.html#cb145-1" aria-hidden="true" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(count<span class="sc">~</span>spray, <span class="at">data=</span>d, <span class="at">family=</span><span class="st">&#39;poisson&#39;</span>) </span></code></pre></div>
<p>glm() is a general function that conducts a generalized linear model
and we must specify the ‘family’ (aka error distribution). The default is the ‘gaussian’ distribution (normal). All the model “calculations” are saved in an object we called ‘glm1’.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="generalized-models.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(glm1, <span class="at">type=</span><span class="dv">2</span>)  <span class="do">## car::Anova will print out an ANOVA table testing </span></span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: count
##       LR Chisq Df Pr(&gt;Chisq)    
## spray   185.83  3  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>For the ANOVA above, the null hypothesis that all group means are equal. The argument, type = 2, provides margin tests, which is usually better than the default Type I, especially for more complicated models. For GLMs, Anova returns a likelihood ratio test with a chi-sq value</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="generalized-models.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm1)   <span class="do">## summary() will provide the model coefficients (ie. the &quot;guts&quot; of the model)</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = count ~ spray, family = &quot;poisson&quot;, data = d)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.3852  -0.9345  -0.1482   0.7048   2.6709  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  2.67415    0.07581  35.274   &lt;2e-16 ***
## sprayB       0.05588    0.10574   0.528    0.597    
## sprayC      -1.94018    0.21389  -9.071   &lt;2e-16 ***
## sprayF       0.13926    0.10367   1.343    0.179    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 262.154  on 47  degrees of freedom
## Residual deviance:  76.323  on 44  degrees of freedom
## AIC: 273.93
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>The coefficients allow you rebuild the means from the linear model. Rebuilding the model from the coefficients is not super helpful and the p-values aren’t very meaningful. Residual deviance should be about equal to the degrees of freedom. More than twice as high is problematic.</p>
<p>Now let’s check assumptions of model by examining residuals:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="generalized-models.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(glm1)) <span class="do">## residuals should be normally distributed, but don&#39;t need to be for GLMs</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="generalized-models.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(glm1)<span class="sc">~</span><span class="fu">fitted</span>(glm1))  <span class="do">## residuals should be evenly dispersed around 0 across the range of x&#39;s</span></span>
<span id="cb151-2"><a href="generalized-models.html#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)                               <span class="co"># funnel shapes or curvature is bad</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-2.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="generalized-models.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">resid</span>(glm1))  <span class="do">## calls from car package, residuals should line up pretty closely to the blue line</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-70-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre><code>## [1] 27 23</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="generalized-models.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># points that drift from line might be outliers</span></span>
<span id="cb154-2"><a href="generalized-models.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(glm1) <span class="sc">~</span> d<span class="sc">$</span>spray)  <span class="do">## variances should be homogeneous for each group</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-70-2.png" width="960" style="display: block; margin: auto;" /></p>
<p>Diagnosing more complex GLMs can be very difficult. Residuals are often NOT NORMALLY DISTRIBUTED. We will return to this later…</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="generalized-models.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(glm1, <span class="sc">~</span>spray) <span class="do">## emmeans::emmmeans will rebuild the model for you</span></span></code></pre></div>
<pre><code>##  spray emmean     SE  df asymp.LCL asymp.UCL
##  A      2.674 0.0758 Inf     2.526      2.82
##  B      2.730 0.0737 Inf     2.586      2.87
##  C      0.734 0.2000 Inf     0.342      1.13
##  F      2.813 0.0707 Inf     2.675      2.95
## 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95</code></pre>
<p>The emmeans code above will print off the means, SE, and confidence intervals for each treatment group. Note, the coefficients are on the log-scale (look at model).</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="generalized-models.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(glm1, pairwise<span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)  <span class="do">## adding &#39;pairwise&#39; will conduct pairwise contrasts -- ie. compare each group mean to the others</span></span></code></pre></div>
<pre><code>## $emmeans
##  spray  rate    SE  df asymp.LCL asymp.UCL
##  A     14.50 1.099 Inf     12.50     16.82
##  B     15.33 1.130 Inf     13.27     17.72
##  C      2.08 0.417 Inf      1.41      3.08
##  F     16.67 1.179 Inf     14.51     19.14
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale 
## 
## $contrasts
##  contrast ratio     SE  df null z.ratio p.value
##  A / B    0.946 0.1000 Inf    1  -0.528  0.9522
##  A / C    6.960 1.4886 Inf    1   9.071  &lt;.0001
##  A / F    0.870 0.0902 Inf    1  -1.343  0.5352
##  B / C    7.360 1.5688 Inf    1   9.364  &lt;.0001
##  B / F    0.920 0.0940 Inf    1  -0.816  0.8468
##  C / F    0.125 0.0265 Inf    1  -9.803  &lt;.0001
## 
## P value adjustment: tukey method for comparing a family of 4 estimates 
## Tests are performed on the log scale</code></pre>
<p>Adding the argument ‘pairwise’ will conduct pairwise contrasts – ie. compare each group mean to the others. This automatically adjusts p-values using the ‘tukey’ adjust. This can be changed using ‘adjust=XX’ within the emmeans function. The type=‘response’ will back-transform (ie. exponentiate) to the original scale</p>
<p>Let’s compare residuals for normal, log-transformed, and poisson models:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="generalized-models.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb159-2"><a href="generalized-models.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm1) <span class="sc">~</span> d<span class="sc">$</span>spray) </span>
<span id="cb159-3"><a href="generalized-models.html#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm2) <span class="sc">~</span> d<span class="sc">$</span>spray) </span>
<span id="cb159-4"><a href="generalized-models.html#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(glm1) <span class="sc">~</span> d<span class="sc">$</span>spray) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-73-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="generalized-models.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## null device 
##           1</code></pre>
<p>Let’s also compare means for normal, log-transformed, and poisson models:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="generalized-models.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(lm1, <span class="sc">~</span>spray)</span></code></pre></div>
<pre><code>##  spray emmean   SE df lower.CL upper.CL
##  A      14.50 1.32 44   11.849    17.15
##  B      15.33 1.32 44   12.683    17.98
##  C       2.08 1.32 44   -0.567     4.73
##  F      16.67 1.32 44   14.016    19.32
## 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="generalized-models.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(lm2, <span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span></code></pre></div>
<pre><code>##  spray response    SE df lower.CL upper.CL
##  A        13.83 1.779 44    10.65     17.9
##  B        14.75 1.889 44    11.36     19.1
##  C         1.59 0.311 44     1.04      2.3
##  F        15.70 2.004 44    12.12     20.3
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log(mu + 1) scale</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="generalized-models.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(glm1, <span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span></code></pre></div>
<pre><code>##  spray  rate    SE  df asymp.LCL asymp.UCL
##  A     14.50 1.099 Inf     12.50     16.82
##  B     15.33 1.130 Inf     13.27     17.72
##  C      2.08 0.417 Inf      1.41      3.08
##  F     16.67 1.179 Inf     14.51     19.14
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="module-4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="overdispersion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-Module_4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
