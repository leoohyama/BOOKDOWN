<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Module 6 | Statistics in R</title>
  <meta name="description" content="<p>This is a trial run of putting out a book for a stats class.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Module 6 | Statistics in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a trial run of putting out a book for a stats class.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Module 6 | Statistics in R" />
  
  <meta name="twitter:description" content="<p>This is a trial run of putting out a book for a stats class.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Phil Hahn &amp; Leo Ohyama" />


<meta name="date" content="2022-09-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="module-5.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> url: your book url like <span>https://bookdown.org/yihui/bookdown</span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.1</b> Usage</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#render-book"><i class="fa fa-check"></i><b>1.2</b> Render book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preview-book"><i class="fa fa-check"></i><b>1.3</b> Preview book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="module-2.html"><a href="module-2.html"><i class="fa fa-check"></i><b>2</b> Module 2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="module-2.html"><a href="module-2.html#a.-introduction-to-data-visualization"><i class="fa fa-check"></i><b>2.1</b> 2A. Introduction to Data Visualization</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="module-2.html"><a href="module-2.html#continuous-variables"><i class="fa fa-check"></i><b>2.1.1</b> Continuous Variables</a></li>
<li class="chapter" data-level="2.1.2" data-path="module-2.html"><a href="module-2.html#fancy-scatterplots"><i class="fa fa-check"></i><b>2.1.2</b> Fancy Scatterplots</a></li>
<li class="chapter" data-level="2.1.3" data-path="module-2.html"><a href="module-2.html#continuous-variables-1"><i class="fa fa-check"></i><b>2.1.3</b> Continuous Variables</a></li>
<li class="chapter" data-level="2.1.4" data-path="module-2.html"><a href="module-2.html#different-types-of-plots-for-categorical-data-with-ggplot2"><i class="fa fa-check"></i><b>2.1.4</b> Different types of plots for categorical data with ggplot2</a></li>
<li class="chapter" data-level="2.1.5" data-path="module-2.html"><a href="module-2.html#breakout-group-challenge"><i class="fa fa-check"></i><b>2.1.5</b> Breakout group challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="module-2.html"><a href="module-2.html#b.-introduction-to-regression"><i class="fa fa-check"></i><b>2.2</b> 2B. Introduction to Regression</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="module-2.html"><a href="module-2.html#an-example-of-linear-regression-in-r"><i class="fa fa-check"></i><b>2.2.1</b> An Example of Linear Regression in R</a></li>
<li class="chapter" data-level="2.2.2" data-path="module-2.html"><a href="module-2.html#regression-challenge"><i class="fa fa-check"></i><b>2.2.2</b> Regression Challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="module-2.html"><a href="module-2.html#c.-introduction-to-anova"><i class="fa fa-check"></i><b>2.3</b> 2C. Introduction to ANOVA</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="module-2.html"><a href="module-2.html#example-of-a-one-way-anova-in-r"><i class="fa fa-check"></i><b>2.3.1</b> Example of a one-way ANOVA in R</a></li>
<li class="chapter" data-level="2.3.2" data-path="module-2.html"><a href="module-2.html#anova-challenge"><i class="fa fa-check"></i><b>2.3.2</b> ANOVA Challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="module-2.html"><a href="module-2.html#extra-data-visualization"><i class="fa fa-check"></i><b>2.4</b> Extra Data Visualization</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="module-2.html"><a href="module-2.html#adding-averages-to-plots-part-2"><i class="fa fa-check"></i><b>2.4.1</b> Adding averages to plots part 2</a></li>
<li class="chapter" data-level="2.4.2" data-path="module-2.html"><a href="module-2.html#r-challenge"><i class="fa fa-check"></i><b>2.4.2</b> R Challenge</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="module-3.html"><a href="module-3.html"><i class="fa fa-check"></i><b>3</b> Module 3</a>
<ul>
<li class="chapter" data-level="3.1" data-path="module-3.html"><a href="module-3.html#a.-data-management"><i class="fa fa-check"></i><b>3.1</b> 3A. Data Management</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="module-3.html"><a href="module-3.html#making-and-modifying-variables"><i class="fa fa-check"></i><b>3.1.1</b> Making and modifying variables</a></li>
<li class="chapter" data-level="3.1.2" data-path="module-3.html"><a href="module-3.html#variables-with-the-tidyverse"><i class="fa fa-check"></i><b>3.1.2</b> Variables with the tidyverse</a></li>
<li class="chapter" data-level="3.1.3" data-path="module-3.html"><a href="module-3.html#reshape-data-for-better-usability"><i class="fa fa-check"></i><b>3.1.3</b> Reshape data for better usability</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="module-3.html"><a href="module-3.html#b.-data-exploration"><i class="fa fa-check"></i><b>3.2</b> 3B. Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="module-3.html"><a href="module-3.html#distributions-summary-statistics"><i class="fa fa-check"></i><b>3.2.1</b> Distributions &amp; summary statistics</a></li>
<li class="chapter" data-level="3.2.2" data-path="module-3.html"><a href="module-3.html#examining-for-outliers"><i class="fa fa-check"></i><b>3.2.2</b> Examining for outliers</a></li>
<li class="chapter" data-level="3.2.3" data-path="module-3.html"><a href="module-3.html#explore-relationships"><i class="fa fa-check"></i><b>3.2.3</b> Explore relationships</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="module-3.html"><a href="module-3.html#c.-model-selection"><i class="fa fa-check"></i><b>3.3</b> 3C. Model Selection</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="module-3.html"><a href="module-3.html#quick-introduction"><i class="fa fa-check"></i><b>3.3.1</b> Quick introduction</a></li>
<li class="chapter" data-level="3.3.2" data-path="module-3.html"><a href="module-3.html#basic-calculations"><i class="fa fa-check"></i><b>3.3.2</b> Basic calculations</a></li>
<li class="chapter" data-level="3.3.3" data-path="module-3.html"><a href="module-3.html#aicc"><i class="fa fa-check"></i><b>3.3.3</b> AICc</a></li>
<li class="chapter" data-level="3.3.4" data-path="module-3.html"><a href="module-3.html#case-study-with-aic"><i class="fa fa-check"></i><b>3.3.4</b> Case study with AIC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="module-4.html"><a href="module-4.html"><i class="fa fa-check"></i><b>4</b> Module 4</a>
<ul>
<li class="chapter" data-level="4.1" data-path="module-4.html"><a href="module-4.html#a.-generalized-models"><i class="fa fa-check"></i><b>4.1</b> 4A. Generalized Models</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="module-4.html"><a href="module-4.html#example-conducting-a-one-way-anova-with-non-normal-data"><i class="fa fa-check"></i><b>4.1.1</b> Example: Conducting a one-way ANOVA with non-normal data</a></li>
<li class="chapter" data-level="4.1.2" data-path="module-4.html"><a href="module-4.html#log-linear-model"><i class="fa fa-check"></i><b>4.1.2</b> Log-linear model</a></li>
<li class="chapter" data-level="4.1.3" data-path="module-4.html"><a href="module-4.html#generalized-linear-models"><i class="fa fa-check"></i><b>4.1.3</b> Generalized linear models</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="module-4.html"><a href="module-4.html#b.-overdispersion"><i class="fa fa-check"></i><b>4.2</b> 4B. Overdispersion</a></li>
<li class="chapter" data-level="4.3" data-path="module-4.html"><a href="module-4.html#c.-binomial-glm"><i class="fa fa-check"></i><b>4.3</b> 4C. Binomial GLM</a></li>
<li class="chapter" data-level="4.4" data-path="module-4.html"><a href="module-4.html#gamma-glm"><i class="fa fa-check"></i><b>4.4</b> Gamma GLM</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="module-4.html"><a href="module-4.html#example-1"><i class="fa fa-check"></i><b>4.4.1</b> Example 1</a></li>
<li class="chapter" data-level="4.4.2" data-path="module-4.html"><a href="module-4.html#example-2"><i class="fa fa-check"></i><b>4.4.2</b> Example 2</a></li>
<li class="chapter" data-level="4.4.3" data-path="module-4.html"><a href="module-4.html#example-3"><i class="fa fa-check"></i><b>4.4.3</b> Example 3</a></li>
<li class="chapter" data-level="4.4.4" data-path="module-4.html"><a href="module-4.html#example-4"><i class="fa fa-check"></i><b>4.4.4</b> Example 4</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="module-4.html"><a href="module-4.html#running-gamma-glms"><i class="fa fa-check"></i><b>4.5</b> Running Gamma GLMs</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="module-5.html"><a href="module-5.html"><i class="fa fa-check"></i><b>5</b> Module 5</a>
<ul>
<li class="chapter" data-level="5.1" data-path="module-5.html"><a href="module-5.html#a.-ancovas-in-r"><i class="fa fa-check"></i><b>5.1</b> 5A. ANCOVAs in R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="module-5.html"><a href="module-5.html#ancova-multiple-intercept-model"><i class="fa fa-check"></i><b>5.1.1</b> ANCOVA: multiple intercept model</a></li>
<li class="chapter" data-level="5.1.2" data-path="module-5.html"><a href="module-5.html#ancova-multiple-intercept-and-slope-model"><i class="fa fa-check"></i><b>5.1.2</b> ANCOVA: multiple intercept AND slope model</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="module-5.html"><a href="module-5.html#b.-block-designs"><i class="fa fa-check"></i><b>5.2</b> 5B. Block Designs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="module-5.html"><a href="module-5.html#data-and-plotting"><i class="fa fa-check"></i><b>5.2.1</b> Data and Plotting</a></li>
<li class="chapter" data-level="5.2.2" data-path="module-5.html"><a href="module-5.html#models"><i class="fa fa-check"></i><b>5.2.2</b> Models</a></li>
<li class="chapter" data-level="5.2.3" data-path="module-5.html"><a href="module-5.html#blocks-as-random-effects"><i class="fa fa-check"></i><b>5.2.3</b> Blocks as Random Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="module-6.html"><a href="module-6.html"><i class="fa fa-check"></i><b>6</b> Module 6</a>
<ul>
<li class="chapter" data-level="6.1" data-path="module-6.html"><a href="module-6.html#a.-poisson-glmms"><i class="fa fa-check"></i><b>6.1</b> 6A. Poisson GLMMs</a></li>
<li class="chapter" data-level="6.2" data-path="module-6.html"><a href="module-6.html#improving-the-models-whats-next"><i class="fa fa-check"></i><b>6.2</b> Improving the models: What’s next?</a></li>
<li class="chapter" data-level="6.3" data-path="module-6.html"><a href="module-6.html#b.-binomial-and-beta-glmms"><i class="fa fa-check"></i><b>6.3</b> 6B. Binomial and Beta GLMMs</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="module-6.html"><a href="module-6.html#binomial"><i class="fa fa-check"></i><b>6.3.1</b> Binomial</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="module-6.html"><a href="module-6.html#c.-beta-distributions"><i class="fa fa-check"></i><b>6.4</b> 6C. Beta Distributions</a></li>
<li class="chapter" data-level="6.5" data-path="module-6.html"><a href="module-6.html#d.-problem-set"><i class="fa fa-check"></i><b>6.5</b> 6D. Problem set</a></li>
<li class="chapter" data-level="6.6" data-path="module-6.html"><a href="module-6.html#e.x-zero-inflated-models"><i class="fa fa-check"></i><b>6.6</b> 6E.x Zero-Inflated Models</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="module-6" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Module 6<a href="module-6.html#module-6" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="a.-poisson-glmms" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> 6A. Poisson GLMMs<a href="module-6.html#a.-poisson-glmms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this module we will go over a variety of more advanced models. We will start with Poisson GLMMs. Let’s first load the libraries we will need:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="module-6.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="module-6.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb1-3"><a href="module-6.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-4"><a href="module-6.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agridat)</span>
<span id="cb1-5"><a href="module-6.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-6"><a href="module-6.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1-7"><a href="module-6.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb1-8"><a href="module-6.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb1-9"><a href="module-6.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb1-10"><a href="module-6.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb1-11"><a href="module-6.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbmle)</span>
<span id="cb1-12"><a href="module-6.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aods3)</span></code></pre></div>
<p>Let’s load in and read about the beall.webworms dataset. The variables of interest are the y-count of webworms, spray- spray treatment, and lead-lead treatment. Don’t worry about the block or other variables for now.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="module-6.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;beall.webworms&quot;</span>)</span>
<span id="cb2-2"><a href="module-6.html#cb2-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> beall.webworms</span>
<span id="cb2-3"><a href="module-6.html#cb2-3" aria-hidden="true" tabindex="-1"></a>?beall.webworms  <span class="do">## info about the beall.webworms dataset</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="module-6.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d1) <span class="do">## view data set</span></span></code></pre></div>
<pre><code>##   row col y block trt spray lead
## 1   1   1 1    B1  T1     N    N
## 2   2   1 0    B1  T1     N    N
## 3   3   1 1    B1  T1     N    N
## 4   4   1 3    B1  T1     N    N
## 5   5   1 6    B1  T1     N    N
## 6   6   1 0    B2  T1     N    N</code></pre>
<p>Let’s examine a plot of data:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="module-6.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d1, <span class="fu">aes</span>(<span class="at">x=</span>spray, <span class="at">y=</span>y, <span class="at">fill=</span>lead)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="module-6.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">scale=</span><span class="st">&quot;width&quot;</span>, <span class="at">adjust=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb5-3"><a href="module-6.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width=</span>.<span class="dv">5</span>,</span>
<span id="cb5-4"><a href="module-6.html#cb5-4" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">jitter.height=</span>.<span class="dv">1</span>,</span>
<span id="cb5-5"><a href="module-6.html#cb5-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">dodge.width =</span> <span class="dv">1</span>),</span>
<span id="cb5-6"><a href="module-6.html#cb5-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha=</span>.<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb5-7"><a href="module-6.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>block)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Here we create two models, r1 and r2. They were previously used in module 4C:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="module-6.html#cb6-1" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead, <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb6-2"><a href="module-6.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(r1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ spray * lead, family = &quot;poisson&quot;, data = d1)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6733  -1.0046  -0.9081   0.6141   4.2771  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.33647    0.04688   7.177 7.12e-13 ***
## sprayY       -1.02043    0.09108 -11.204  &lt; 2e-16 ***
## leadY        -0.49628    0.07621  -6.512 7.41e-11 ***
## sprayY:leadY  0.29425    0.13917   2.114   0.0345 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 1955.9  on 1299  degrees of freedom
## Residual deviance: 1720.4  on 1296  degrees of freedom
## AIC: 3125.5
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="module-6.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(r1)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: y
##            LR Chisq Df Pr(&gt;Chisq)    
## spray       188.707  1  &lt; 2.2e-16 ***
## lead         42.294  1  7.853e-11 ***
## spray:lead    4.452  1    0.03485 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="module-6.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(r1, <span class="sc">~</span>spray<span class="sc">:</span>lead, <span class="at">type=</span><span class="st">&#39;response&#39;</span>) </span></code></pre></div>
<pre><code>##  spray lead  rate     SE  df asymp.LCL asymp.UCL
##  N     N    1.400 0.0656 Inf     1.277     1.535
##  Y     N    0.505 0.0394 Inf     0.433     0.588
##  N     Y    0.852 0.0512 Inf     0.758     0.959
##  Y     Y    0.412 0.0356 Inf     0.348     0.488
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
<p>We check overdispersion in the model:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="module-6.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_overdispersion</span>(r1) <span class="co"># overdispersion ratio calculator from performance</span></span></code></pre></div>
<pre><code>## # Overdispersion test
## 
##        dispersion ratio =    1.355
##   Pearson&#39;s Chi-Squared = 1755.717
##                 p-value =  &lt; 0.001</code></pre>
<p>Now let’s implment the r2 model with a negative binomial error distribution:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="module-6.html#cb14-1" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead, <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;nbinom2&quot;</span>)</span>
<span id="cb14-2"><a href="module-6.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(r2)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: y
##               Chisq Df Pr(&gt;Chisq)    
## spray      125.5047  1  &lt; 2.2e-16 ***
## lead        26.8005  1  2.256e-07 ***
## spray:lead   3.3942  1    0.06542 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="module-6.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(r2, <span class="sc">~</span>spray<span class="sc">:</span>lead, <span class="at">type=</span><span class="st">&#39;response&#39;</span>) </span></code></pre></div>
<pre><code>##  spray lead response     SE   df lower.CL upper.CL
##  N     N       1.400 0.0855 1295    1.242    1.578
##  Y     N       0.505 0.0441 1295    0.425    0.599
##  N     Y       0.852 0.0611 1295    0.740    0.981
##  Y     Y       0.412 0.0391 1295    0.342    0.497
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
<p>Now let’s simulate residuals for poisson and negative binomial models:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="module-6.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(r1))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="module-6.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">simulateResiduals</span>(r1)) <span class="do">## histogram should be flat</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-2.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="module-6.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(r2))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-9-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="module-6.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">simulateResiduals</span>(r2)) <span class="do">## histogram should be flat</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-9-2.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="improving-the-models-whats-next" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Improving the models: What’s next?<a href="module-6.html#improving-the-models-whats-next" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What’s next? Any aspects of the experimental design missing from the model?</p>
<p>We can construct models that includes any missing factors.</p>
<p>We can also make an individual-level random effect to use for overdispersed poisson:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="module-6.html#cb22-1" aria-hidden="true" tabindex="-1"></a>d1<span class="sc">$</span>obs <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(d1<span class="sc">$</span>y) <span class="do">## makes a unique number for each row in dataset</span></span></code></pre></div>
<p>We can also create other models that include different random effects that account for blocks:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="module-6.html#cb23-1" aria-hidden="true" tabindex="-1"></a>r0 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead, <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>)              <span class="do">### gaussian glm just to see how bad it really is</span></span>
<span id="cb23-2"><a href="module-6.html#cb23-2" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead, <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)               <span class="do">### poisson glm</span></span>
<span id="cb23-3"><a href="module-6.html#cb23-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead, <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;nbinom2&quot;</span>)               <span class="do">### nb glm</span></span>
<span id="cb23-4"><a href="module-6.html#cb23-4" aria-hidden="true" tabindex="-1"></a>r3 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>obs), <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)     <span class="do">### overdispersed poisson glm</span></span>
<span id="cb23-5"><a href="module-6.html#cb23-5" aria-hidden="true" tabindex="-1"></a>r4 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block), <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;nbinom2&quot;</span>)   <span class="do">### nb w/ block</span></span>
<span id="cb23-6"><a href="module-6.html#cb23-6" aria-hidden="true" tabindex="-1"></a>r5 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>obs) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block), <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)   <span class="do">### OD poisson w/ block</span></span></code></pre></div>
<p>Six models above differ only distribution and random effects. Fixed effects are the same. We can now use AIC for selecting the most appropriate distribution and random effects:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="module-6.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### for model selection, use AIC or likihood ratio test</span></span>
<span id="cb24-2"><a href="module-6.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.sel</span>(r0,r1,r2,r3,r4,r5) <span class="do">## from MuMIn</span></span></code></pre></div>
<pre><code>## Model selection table 
##    cnd((Int)) dsp((Int)) cnd(led) cnd(spr) cnd(led:spr)             family
## r4     0.2835          +        +        +            +       nbinom2(log)
## r5     0.1399          +        +        +            +       poisson(log)
## r3     0.1042          +        +        +            +       poisson(log)
## r2     0.3365          +        +        +            +       nbinom2(log)
## r1     0.3365          +        +        +            +       poisson(log)
## r0     1.4000          +        +        +            + gaussian(identity)
##       random df    logLik   AICc  delta weight
## r4      c(b)  6 -1497.706 3007.5   0.00  0.903
## r5 c(o)+c(b)  6 -1499.931 3011.9   4.45  0.097
## r3      c(o)  5 -1518.031 3046.1  38.63  0.000
## r2            5 -1521.484 3053.0  45.54  0.000
## r1            4 -1558.739 3125.5 118.03  0.000
## r0            5 -1929.308 3868.7 861.18  0.000
## Models ranked by AICc(x) 
## Random terms: 
## c(b) = &#39;cond(1 | block)&#39;
## c(o) = &#39;cond(1 | obs)&#39;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="module-6.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AICtab</span>(r0,r1,r2,r3,r4,r5,<span class="at">base=</span>T,<span class="at">logLik=</span>T,<span class="at">weights=</span>T)    <span class="do">## from bbmle</span></span></code></pre></div>
<pre><code>##    logLik  AIC     dLogLik dAIC    df weight
## r4 -1497.7  3007.4   431.6     0.0 6  0.903 
## r5 -1499.9  3011.9   429.4     4.5 6  0.097 
## r3 -1518.0  3046.1   411.3    38.7 5  &lt;0.001
## r2 -1521.5  3053.0   407.8    45.6 5  &lt;0.001
## r1 -1558.7  3125.5   370.6   118.1 4  &lt;0.001
## r0 -1929.3  3868.6     0.0   861.2 5  &lt;0.001</code></pre>
<p>Now for further model interpretation you can examine residuals, fixed effects using Anova(), emmeans, etc.</p>
</div>
<div id="b.-binomial-and-beta-glmms" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> 6B. Binomial and Beta GLMMs<a href="module-6.html#b.-binomial-and-beta-glmms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="binomial" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Binomial<a href="module-6.html#binomial" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this section we look at the binomial distribution. Let’s load in the data we will use:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="module-6.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;wheatley.carrot&quot;</span>)</span>
<span id="cb28-2"><a href="module-6.html#cb28-2" aria-hidden="true" tabindex="-1"></a>?wheatley.carrot</span></code></pre></div>
<p>Let’s clean it up a bit:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="module-6.html#cb29-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> wheatley.carrot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(insecticide<span class="sc">!=</span><span class="st">&#39;nil&#39;</span>)</span>
<span id="cb29-2"><a href="module-6.html#cb29-2" aria-hidden="true" tabindex="-1"></a>dat1<span class="sc">$</span>propdmg <span class="ot">&lt;-</span> dat1<span class="sc">$</span>damaged<span class="sc">/</span>dat1<span class="sc">$</span>total</span>
<span id="cb29-3"><a href="module-6.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat1) </span></code></pre></div>
<pre><code>##   treatment insecticide depth rep damaged total    propdmg
## 1       T01    diazinon   1.0  R1     120   187 0.64171123
## 2       T02    diazinon   2.5  R1      60   184 0.32608696
## 3       T03    diazinon   5.0  R1      35   179 0.19553073
## 4       T04    diazinon  10.0  R1       5   178 0.02808989
## 5       T05    diazinon  25.0  R1      66   182 0.36263736
## 6       T06  disulfoton   1.0  R1      97   187 0.51871658</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="module-6.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat1<span class="sc">$</span>propdmg)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now let’s plot out the data. Note that for plotting we can use the “beta_family” although for analysis we use “binomial”.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="module-6.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(depth),</span>
<span id="cb32-2"><a href="module-6.html#cb32-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y=</span>(damaged<span class="sc">/</span>total), <span class="at">color=</span>insecticide)) <span class="sc">+</span></span>
<span id="cb32-3"><a href="module-6.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb32-4"><a href="module-6.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="module-6.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(depth), <span class="at">y=</span>(damaged<span class="sc">/</span>total), <span class="at">color=</span>insecticide)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="module-6.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="module-6.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;glm&#39;</span>,</span>
<span id="cb33-4"><a href="module-6.html#cb33-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args=</span><span class="fu">list</span>(<span class="at">family=</span><span class="st">&quot;beta_family&quot;</span>),</span>
<span id="cb33-5"><a href="module-6.html#cb33-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y<span class="sc">~</span>x) <span class="sc">+</span></span>
<span id="cb33-6"><a href="module-6.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="module-6.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(depth), <span class="at">y=</span>(damaged<span class="sc">/</span>total),</span>
<span id="cb34-2"><a href="module-6.html#cb34-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span>insecticide)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-3"><a href="module-6.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;glm&#39;</span>, </span>
<span id="cb34-4"><a href="module-6.html#cb34-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args=</span><span class="fu">list</span>(<span class="at">family=</span><span class="st">&quot;beta_family&quot;</span>), </span>
<span id="cb34-5"><a href="module-6.html#cb34-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y<span class="sc">~</span>x<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now let’s build two different binomical GLMMs with different set ups:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="module-6.html#cb35-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(<span class="fu">cbind</span>(damaged,total<span class="sc">-</span>damaged) <span class="sc">~</span> insecticide <span class="sc">*</span> depth <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>rep), <span class="at">data=</span>dat1, <span class="at">family=</span><span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb35-2"><a href="module-6.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="module-6.html#cb35-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(<span class="fu">cbind</span>(damaged,total<span class="sc">-</span>damaged) <span class="sc">~</span> insecticide <span class="sc">*</span> depth <span class="sc">+</span> <span class="fu">I</span>(depth<span class="sc">**</span><span class="dv">2</span>) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>rep), <span class="at">data=</span>dat1, <span class="at">family=</span><span class="st">&#39;binomial&#39;</span>)</span></code></pre></div>
<p>Note above that mod2 is applying a non-linear modification where we include depth and depth squared. The “**” is another way of saying raise depth to the 2nd power. The I() isolate this and tells the R interpreter that the model is including a second order fixed effect. For more info check ?formula.</p>
<p>We can plot residuals:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="module-6.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod1))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="module-6.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod2))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-2.png" width="960" style="display: block; margin: auto;" />
Which of the two is better?</p>
<p>We can also run ANOVAs on the models:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="module-6.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod1)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: cbind(damaged, total - damaged)
##                    Chisq Df Pr(&gt;Chisq)    
## insecticide       91.449  1  &lt; 2.2e-16 ***
## depth              2.543  1  0.1107873    
## insecticide:depth 14.525  1  0.0001383 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="module-6.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod2)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: cbind(damaged, total - damaged)
##                    Chisq Df Pr(&gt;Chisq)    
## insecticide       111.62  1  &lt; 2.2e-16 ***
## depth             563.71  1  &lt; 2.2e-16 ***
## I(depth^2)        594.17  1  &lt; 2.2e-16 ***
## insecticide:depth  15.85  1  6.858e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="c.-beta-distributions" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> 6C. Beta Distributions<a href="module-6.html#c.-beta-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we show an example of applying the beta family using true proportions (or percentages). First let’s load data:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="module-6.html#cb42-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;LynnETAL_2022_Ecography_sodCaseStudy.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="module-6.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">==</span><span class="st">&#39;SALA&#39;</span>)</span>
<span id="cb42-3"><a href="module-6.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(b1)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 18
##   study        family speci…¹ species meas_…² site  latit…³ longi…⁴ o_lat o_long
##   &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 RivkinETAL_… Alism… Sagitt… SALA    2015    ACT-…    44.5   -77.3    NA     NA
## 2 RivkinETAL_… Alism… Sagitt… SALA    2015    BPV-…    45.7   -77.6    NA     NA
## 3 RivkinETAL_… Alism… Sagitt… SALA    2015    BSM-…    44.8   -76.1    NA     NA
## 4 RivkinETAL_… Alism… Sagitt… SALA    2015    BTC-…    44.2   -76.8    NA     NA
## 5 RivkinETAL_… Alism… Sagitt… SALA    2015    CBT-…    47.4   -79.7    NA     NA
## 6 RivkinETAL_… Alism… Sagitt… SALA    2015    CFR-…    44.7   -77.1    NA     NA
## # … with 8 more variables: mean_herb &lt;dbl&gt;, na_wdcpc &lt;dbl&gt;, mat &lt;dbl&gt;,
## #   iso &lt;dbl&gt;, dtr &lt;dbl&gt;, precip &lt;dbl&gt;, aet &lt;dbl&gt;, notes &lt;chr&gt;, and abbreviated
## #   variable names ¹​species_name, ²​meas_year, ³​latitude, ⁴​longitude</code></pre>
<p>Let’s examine a histogram:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="module-6.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(b1<span class="sc">$</span>mean_herb) <span class="do">## examine histogram. Data are entered as percentage (0-100%)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Let’s plot out the data. Note: data was collected at 42 unique sites (one data point per site).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="module-6.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(b1 , <span class="fu">aes</span>(<span class="at">x=</span>latitude, <span class="at">y=</span>mean_herb)) <span class="sc">+</span></span>
<span id="cb45-2"><a href="module-6.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now we need to convert to proportion and then do a small transformation to remove 0 and 1:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="module-6.html#cb46-1" aria-hidden="true" tabindex="-1"></a>b1<span class="sc">$</span>mean_herb1 <span class="ot">&lt;-</span> (b1<span class="sc">$</span>mean_herb<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb46-2"><a href="module-6.html#cb46-2" aria-hidden="true" tabindex="-1"></a>b1<span class="sc">$</span>mean_herb1 <span class="ot">&lt;-</span> (b1<span class="sc">$</span>mean_herb1<span class="sc">*</span>(<span class="fu">length</span>(b1<span class="sc">$</span>mean_herb1)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span>.<span class="dv">5</span>)<span class="sc">/</span><span class="fu">length</span>(b1<span class="sc">$</span>mean_herb1)</span></code></pre></div>
<p>Let’s plot this:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="module-6.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(b1, <span class="fu">aes</span>(<span class="at">x=</span>latitude, <span class="at">y=</span>mean_herb1)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-2"><a href="module-6.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;glm&#39;</span>, </span>
<span id="cb47-3"><a href="module-6.html#cb47-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args=</span><span class="fu">list</span>(<span class="at">family=</span><span class="st">&quot;beta_family&quot;</span>),</span>
<span id="cb47-4"><a href="module-6.html#cb47-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y<span class="sc">~</span>x)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now let’s build a beta GLMM:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="module-6.html#cb48-1" aria-hidden="true" tabindex="-1"></a>bm1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(mean_herb1 <span class="sc">~</span> latitude, <span class="at">data=</span>b1, <span class="at">family=</span><span class="st">&#39;beta_family&#39;</span>)</span>
<span id="cb48-2"><a href="module-6.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(bm1)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: mean_herb1
##           Chisq Df Pr(&gt;Chisq)   
## latitude 9.1383  1   0.002503 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Check the summary:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="module-6.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bm1)</span></code></pre></div>
<pre><code>##  Family: beta  ( logit )
## Formula:          mean_herb1 ~ latitude
## Data: b1
## 
##      AIC      BIC   logLik deviance df.resid 
##   -126.9   -121.7     66.5   -132.9       39 
## 
## 
## Dispersion parameter for beta family (): 30.5 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  5.69631    2.58221   2.206   0.0274 * 
## latitude    -0.17525    0.05797  -3.023   0.0025 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Plot and check residuals:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="module-6.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(bm1)) <span class="do">## QQ plot is good. Resid vs pred is wiggle, probably ok.</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-29-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="d.-problem-set" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> 6D. Problem set<a href="module-6.html#d.-problem-set" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Problem set with real data (Rivkin et al. 2018 Am J Bot)</li>
</ol>
<p>Herbivory data was collected on 43 populations of an aquatic plant across a latitudinal gradient in Canada. At each population, many plants (~5-15) were examined for herbivory damage. Some additional covariates were recorded, such as Competition around the plant (1-3 from less to more) and plant height (cm).</p>
<p>Read in data:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="module-6.html#cb53-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;ajb21098-sup-0002-appendixs2.csv&quot;</span>)</span>
<span id="cb53-2"><a href="module-6.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d1)</span></code></pre></div>
<pre><code>##   Population Latitude Longitude Competition Individual PlantHeight LeafDamage
## 1     ACT-ON 44.54829 -77.32384           2          4        41.0 0.02000000
## 2     ACT-ON 44.54829 -77.32384           2          6        43.0 0.03000000
## 3     ACT-ON 44.54829 -77.32384           2         18        17.5 0.04000000
## 4     ACT-ON 44.54829 -77.32384           2          2        37.0 0.06666667
## 5     ACT-ON 44.54829 -77.32384           2          3        48.0 0.07000000
## 6     ACT-ON 44.54829 -77.32384           2         12        39.5 0.08000000
##   LarvalAbundance
## 1               0
## 2               0
## 3               0
## 4               1
## 5               0
## 6               0</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="module-6.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d1<span class="sc">$</span>LeafDamage)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-30-1.png" width="960" style="display: block; margin: auto;" />
Let’s remove 0’s and 1’s (see Smithson &amp; Verkuilen 2006 or Douma &amp; Weedon 2018):</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="module-6.html#cb56-1" aria-hidden="true" tabindex="-1"></a>d1<span class="sc">$</span>LeafDamage <span class="ot">&lt;-</span> (d1<span class="sc">$</span>LeafDamage<span class="sc">*</span>(<span class="fu">length</span>(d1<span class="sc">$</span>LeafDamage)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span>.<span class="dv">5</span>)<span class="sc">/</span><span class="fu">length</span>(d1<span class="sc">$</span>LeafDamage)</span></code></pre></div>
<p>Now plot data:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="module-6.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d1 , <span class="fu">aes</span>(<span class="at">x=</span>Latitude, <span class="at">y=</span>LeafDamage)) <span class="sc">+</span></span>
<span id="cb57-2"><a href="module-6.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb57-3"><a href="module-6.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;glm&#39;</span>, </span>
<span id="cb57-4"><a href="module-6.html#cb57-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args=</span><span class="fu">list</span>(<span class="at">family=</span><span class="st">&quot;beta_family&quot;</span>),</span>
<span id="cb57-5"><a href="module-6.html#cb57-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y<span class="sc">~</span>x)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-32-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Question: Does herbivory increase towards the equator? How do residuals look? Any way to improve them?</p>
<ol start="2" style="list-style-type: decimal">
<li>Problem set with real data (Rivkin et al. 2018 Am J Bot), Rats dataset with only females. Half treated with a drug and the other half were untreated. Then they checked for tumors.Does the drug reduce probability of developing tumor? After 50 days? After 100 days?</li>
</ol>
<p>Load data:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="module-6.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb58-2"><a href="module-6.html#cb58-2" aria-hidden="true" tabindex="-1"></a>rats <span class="ot">&lt;-</span> rats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&quot;f&quot;</span>)</span>
<span id="cb58-3"><a href="module-6.html#cb58-3" aria-hidden="true" tabindex="-1"></a>?rats</span></code></pre></div>
<pre><code>## Help on topic &#39;rats&#39; was found in the following packages:
## 
##   Package               Library
##   aods3                 /Users/leoohyama/Library/R/x86_64/4.1/library
##   survival              /Library/Frameworks/R.framework/Versions/4.1/Resources/library
## 
## 
## Using the first match ...</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="module-6.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rats)</span></code></pre></div>
<pre><code>##   litter rx time status sex
## 1      1  1  101      0   f
## 2      1  0   49      1   f
## 3      1  0  104      0   f
## 4      3  1  104      0   f
## 5      3  0  102      0   f
## 6      3  0  104      0   f</code></pre>
<p>Plot data:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="module-6.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rats , <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>status)) <span class="sc">+</span> </span>
<span id="cb62-2"><a href="module-6.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb62-3"><a href="module-6.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;glm&#39;</span>, </span>
<span id="cb62-4"><a href="module-6.html#cb62-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args=</span><span class="fu">list</span>(<span class="at">family=</span><span class="st">&quot;binomial&quot;</span>), </span>
<span id="cb62-5"><a href="module-6.html#cb62-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y<span class="sc">~</span>x) <span class="sc">+</span> </span>
<span id="cb62-6"><a href="module-6.html#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>rx)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-34-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="e.x-zero-inflated-models" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> 6E.x Zero-Inflated Models<a href="module-6.html#e.x-zero-inflated-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we will go over applying zero-inflated models. First let’s load the data (wheatley carrot infection by carrot fly larvae):</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="module-6.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ridout.appleshoots&quot;</span>)</span></code></pre></div>
<p>Let’s clean up the data and check out the distribution of the data in question:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="module-6.html#cb64-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> ridout.appleshoots <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">photo=</span><span class="fu">as.factor</span>(photo))</span>
<span id="cb64-2"><a href="module-6.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat1<span class="sc">$</span>roots)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-36-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now let’s run several models: a Poisson, a negative binomial, and a negative binomial with a general intercept for zero inflation:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="module-6.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">## poisson model</span></span>
<span id="cb65-2"><a href="module-6.html#cb65-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(roots <span class="sc">~</span> photo <span class="sc">*</span> bap , <span class="at">data=</span>dat1, <span class="at">family=</span><span class="st">&#39;poisson&#39;</span>)</span>
<span id="cb65-3"><a href="module-6.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod1))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-37-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="module-6.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">## negative binomial model</span></span>
<span id="cb66-2"><a href="module-6.html#cb66-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(roots <span class="sc">~</span> photo <span class="sc">*</span> bap , <span class="at">data=</span>dat1, <span class="at">family=</span><span class="st">&#39;nbinom2&#39;</span>)</span>
<span id="cb66-3"><a href="module-6.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod2))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="module-6.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## negative binomial w/ a general intercept for zero inflation (ie. ZI equal for all observations)</span></span>
<span id="cb67-2"><a href="module-6.html#cb67-2" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(roots <span class="sc">~</span> photo <span class="sc">*</span> bap , <span class="at">data=</span>dat1, <span class="at">family=</span><span class="st">&#39;nbinom2&#39;</span>, <span class="at">zi=</span><span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb67-3"><a href="module-6.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod3))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="module-6.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3) <span class="do">## back-transform ZI intercept (exp(p)/(1+exp(p)))</span></span></code></pre></div>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          roots ~ photo * bap
## Zero inflation:         ~1
## Data: dat1
## 
##      AIC      BIC   logLik deviance df.resid 
##   1342.4   1364.0   -665.2   1330.4      264 
## 
## 
## Dispersion parameter for nbinom2 family (): 12.6 
## 
## Conditional model:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.895659   0.072535  26.134   &lt;2e-16 ***
## photo16     -0.029863   0.135890  -0.220   0.8261    
## bap          0.008760   0.006724   1.303   0.1927    
## photo16:bap -0.032083   0.013065  -2.456   0.0141 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Zero-inflation model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -1.226      0.151  -8.125 4.49e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>What do we expect to cause the zero inflation? We can check out further details in the data’s metadata:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="module-6.html#cb70-1" aria-hidden="true" tabindex="-1"></a>??ridout.appleshoots</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="module-6.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1, <span class="fu">aes</span>(<span class="at">x=</span>roots)) <span class="sc">+</span> </span>
<span id="cb71-2"><a href="module-6.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb71-3"><a href="module-6.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(bap<span class="sc">~</span>photo) <span class="sc">+</span> </span>
<span id="cb71-4"><a href="module-6.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">16</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-42-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now let’s run a negative binomial with zero inflation specified by treatment:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="module-6.html#cb72-1" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(roots <span class="sc">~</span> photo <span class="sc">*</span> bap , <span class="at">data=</span>dat1, <span class="at">family=</span><span class="st">&#39;nbinom2&#39;</span>, <span class="at">zi=</span><span class="sc">~</span>photo)</span>
<span id="cb72-2"><a href="module-6.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod4)</span></code></pre></div>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          roots ~ photo * bap
## Zero inflation:         ~photo
## Data: dat1
## 
##      AIC      BIC   logLik deviance df.resid 
##   1252.3   1277.5   -619.2   1238.3      263 
## 
## 
## Dispersion parameter for nbinom2 family (): 13.8 
## 
## Conditional model:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.898347   0.071568  26.525   &lt;2e-16 ***
## photo16     -0.023525   0.130488  -0.180   0.8569    
## bap          0.008222   0.006689   1.229   0.2190    
## photo16:bap -0.029492   0.012427  -2.373   0.0176 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Zero-inflation model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.4000     0.8446  -5.210 1.89e-07 ***
## photo16       4.2831     0.8627   4.965 6.87e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Plot residuals:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="module-6.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod4))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-44-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Now let’s compare all models with AIC. Which one was the best? Why do you think?</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="module-6.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">### check with AIC</span></span>
<span id="cb75-2"><a href="module-6.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(mod1,mod2,mod3,mod4)</span></code></pre></div>
<pre><code>##      df      AIC
## mod1  4 1575.916
## mod2  5 1412.415
## mod3  6 1342.435
## mod4  7 1252.333</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="module-5.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/06-Module_6.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
